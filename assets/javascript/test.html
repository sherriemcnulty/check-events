<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <h1>Hello, world!</h1>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    <!-- Optional JavaScript -->
    <script type="text/javascript">
    // test log that it works...
    console.log('This is working...');

    function makeAPICall() {
        let user_zip,
            user_interests;
            // set user_interests
            user_interests = ['Sports', 'Writing', 'Tech', 'Beliefs'];
            // set user_zip
            user_zip = 23832;
        // declare functions
            function getZip(int) {
                str = '&zip=';
                str += int.toString();
                return str
            }
            function getInterests(arr) {
                var str = '';
                for (var i = 0; i < arr.length; i++) {
                    if ( i === 0) {
                            str += '&categories=' + arr[i] + ', ';
                            } else if ( i < arr.length - 1 ) {
                                str += arr[i] + ', ';
                            } else {
                                str += arr[i];
                            }
                }
                console.log(str);
                return str
            }
        // call functions
            user_zip = getZip(user_zip);
            user_interests = getInterests(user_interests);
        // API CALL
            let APIKey = '&key=f6e8058806230563363254695654e'
        let queryURL = "https://cfe-meetup-api.herokuapp.com/find/groups?" + user_zip + user_interests + '&order=members';

        console.log(queryURL);
        
        // $.ajax({
        // url: queryURL,
        // method: "GET",
        // }).then(function(response) {
        //         display(response);
        //         console.log('Ajax call made...');
        // });
        // function display(data) {
        //     $('body').html(`
        //     <div>${data.name}</div>
        //     `)
        //     console.log(data.name);
        //     console.log('This is working');
        // }
        // $.ajax({
        //     url: queryURL,
        //     method: 'GET',
        //     // This is the important part
        //     xhrFields: {
        //         withCredentials: true
        //     },
        //     // This is the important part
        //     // data: data,
        //     success: function (response) {
        //         // handle the response
        //         console.log(response.name);
        //         console.log('This is working');
        //     },
        //     error: function (xhr, status) {
        //         // handle errors
        //     }
        // });
        // Create the XHR object.
function createCORSRequest(method, url) {
  var xhr = new XMLHttpRequest();
  if ("withCredentials" in xhr) {
    // XHR for Chrome/Firefox/Opera/Safari.
    xhr.open(method, url, true);
  } else if (typeof XDomainRequest != "undefined") {
    // XDomainRequest for IE.
    xhr = new XDomainRequest();
    xhr.open(method, url);
  } else {
    // CORS not supported.
    xhr = null;
  }
  return xhr;
}

// Helper method to parse the title tag from the response.
function getTitle(text) {
  return text.match('<title>(.*)?</title>')[1];
}

// Make the actual CORS request.
function makeCorsRequest() {
    // var url = 'https://api.meetup.com/topics.json?&key=f6e8058806230563363254695654e&zip=23832';
    // var xhr = createCORSRequest('GET', url);
  // This is a sample server that supports CORS.
  var url = 'https://api.meetup.com/topics.json?&key=f6e8058806230563363254695654e&zip=23832';

  var xhr = createCORSRequest('GET', url);
  if (!xhr) {
    alert('CORS not supported');
    return;
  }

  // Response handlers.
  xhr.onload = function() {
    var text = xhr.responseText;
    var title = getTitle(text);
    alert('Response from CORS request to ' + url + ': ' + title);
  };

  xhr.onerror = function() {
    alert('Woops, there was an error making the request.');
  };

  xhr.send();
}
makeCorsRequest();


    }
    makeAPICall();
    </script>
  </body>
</html>